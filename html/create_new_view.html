<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Create new layer in GeoPackage &#8212; GeoPackage Workshop - Geobuzz 2017 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="2. Create new layer in OWS-context file" href="create_new_layer.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo.png" alt="Logo"/>
    
  </a>
</p>










<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="explore_geopackage.html">1. Explore GeoPackage</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_new_layer.html">2. Create new layer in OWS-context file</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Create new layer in GeoPackage</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="create_new_layer.html" title="previous chapter">2. Create new layer in OWS-context file</a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="create-new-layer-in-geopackage">
<h1>3. Create new layer in GeoPackage<a class="headerlink" href="#create-new-layer-in-geopackage" title="Permalink to this headline">Â¶</a></h1>
<p>In this exercise we are going to create a new layer based on a view with a filter. A view in a database can be thought of as a virtual table, only the definition of the view is stored in the database, for more information see the Wikipedia <a class="reference external" href="https://en.wikipedia.org/wiki/View_(SQL)">entry</a> on database views.</p>
<p>For our new view we are only interested in neighborhoods (buurten) that are located in the municipality (gemeente) Den Bosch. To create this view execute the following SQL in the <em>DB Browser for SQLite</em>:</p>
<div class="code SQL highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">buurt_2017_den_bosch</span> <span class="n">AS</span>
<span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">buurt_2017</span>
<span class="n">where</span> <span class="n">GM_NAAM</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;s-Hertogenbosch&#39;;</span>
</pre></div>
</div>
<p>To be able to use the view in the GeoPackage we need to register the view in the table <code class="docutils literal"><span class="pre">gpkg_content</span></code>, otherwise there is no way to know this table contains a dataset. Execute the following SQL query:</p>
<div class="code SQL highlight-default"><div class="highlight"><pre><span></span>    <span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">gpkg_contents</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">last_change</span><span class="p">,</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">srs_id</span><span class="p">)</span>
<span class="n">VALUES</span> <span class="p">(</span><span class="s1">&#39;buurt_2017_den_bosch&#39;</span><span class="p">,</span> <span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="s1">&#39;buurt_2017_den_bosch&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-11-21 09:51:00&#39;</span><span class="p">,</span> <span class="mf">10425.1560058594</span> <span class="p">,</span><span class="mf">10425.1560058594</span> <span class="p">,</span><span class="mf">10425.1560058594</span> <span class="p">,</span><span class="mf">10425.1560058594</span> <span class="p">,</span> <span class="mi">28992</span><span class="p">);</span>
</pre></div>
</div>
<p>Next register in the table <code class="docutils literal"><span class="pre">gpkg_geometry_columns</span></code> what column in the table <code class="docutils literal"><span class="pre">buurt_2017_den_bosch</span></code> contains the geometry:</p>
<div class="code SQL highlight-default"><div class="highlight"><pre><span></span>   INSERT INTO gpkg_geometry_columns (table_name, column_name, geometry_type_name, srs_id, z, m)
   VALUES (&#39;buurt_2017_den_bosch&#39;, &#39;geom&#39;, &#39;MULTIPOLYGON&#39;, 28992, 0 ,0);


Next we can create a new style in a different color scheme, I used the style we created in :ref:`create-new-sld`, changed the name and the title and updated the colors, download it `here &lt;https://drive.geocat.net/public.php?service=files&amp;t=0c70ecac76bff9d33b5325a24e57f188&amp;download&gt;`_.
</pre></div>
</div>
<p>Create a new style record in the table <code class="docutils literal"><span class="pre">owc_style</span></code> with the name <code class="docutils literal"><span class="pre">buurt_2017_den_bosch</span></code>.</p>
<p>Next update the OWS-context file in the <code class="docutils literal"><span class="pre">owc_contex</span></code> table, the OWS-context file is located in the <code class="docutils literal"><span class="pre">content</span></code> column. Here you can add a new entry instead of replacing it since the table does exist in the GeoPackage:</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">entry</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">geocat</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">maps</span><span class="o">//</span><span class="n">layers</span><span class="o">/</span><span class="n">buurt_2017_den_bosch</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">buurt_2017_den_bosch</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">updated</span><span class="o">&gt;</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">21</span><span class="n">T19</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">21</span><span class="o">&lt;/</span><span class="n">updated</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">category</span> <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;http://www.opengis.net/spec/owc/active&quot;</span> <span class="n">term</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">owc</span><span class="p">:</span><span class="n">offering</span> <span class="n">code</span><span class="o">=</span><span class="s2">&quot;http://www.opengis.net/spec/owc-atom/1.0/req/gpkg&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">owc</span><span class="p">:</span><span class="n">content</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#table=buurt_2017_den_bosch&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;application/x-sqlite&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">owc</span><span class="p">:</span><span class="n">styleSet</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">owc</span><span class="p">:</span><span class="n">name</span><span class="o">&gt;</span><span class="n">buurt_2017_den_bosch</span><span class="o">&lt;/</span><span class="n">owc</span><span class="p">:</span><span class="n">name</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">owc</span><span class="p">:</span><span class="n">title</span><span class="o">&gt;</span><span class="n">buurt_2017_den_bosch</span><span class="o">&lt;/</span><span class="n">owc</span><span class="p">:</span><span class="n">title</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">owc</span><span class="p">:</span><span class="n">content</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#table=owc_style&amp;amp;name=buurt_2017_den_bosch&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;application/sld+xml&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;/</span><span class="n">owc</span><span class="p">:</span><span class="n">styleSet</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">owc</span><span class="p">:</span><span class="n">offering</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">entry</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>See the resulting file <a class="reference external" href="https://drive.geocat.net/public.php?service=files&amp;t=fce7e0269ad678355695caf09f5514f2&amp;download">here</a>.</p>
<p>Do not forget to apply the changes for each field, and write the changes to the database before exiting <em>DB Browser for SQLite</em>.</p>
<p>Open up the GeoPackage in QGIS:</p>
<a class="reference internal image-reference" href="_images/den_bosch.png"><img alt="_images/den_bosch.png" class="align-center" src="_images/den_bosch.png" style="width: 400px;" /></a>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, GeoCat BV.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/create_new_view.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>